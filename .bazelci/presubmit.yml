---
tasks:
  macos_latest:
    name: "Latest Bazel"
    platform: macos
    # TODO(b/130360213): Remove this default to use whatever the default in
    # BuildKite is.
    xcode_version: "10.1"
    bazel: latest
    build_targets:
    - "tools/..."
    - "test/..."
    test_flags:
    - "--spawn_strategy=local"
    - "--test_env=PATH"
    # `bazel test` tries to build everything also by default, so skip that so the
    # *_library targets in examples/... aren't built (and fail since they are
    # platform specific).
    - "--build_tests_only"
    test_targets:
    - "tools/..."
    - "test/..."
    - "examples/..."

  macos_last_green:
    name: "Last Green Bazel"
    platform: macos
    # TODO(b/130360213): Remove this default to use whatever the default in
    # BuildKite is.
    xcode_version: "10.1"
    bazel: last_green
    build_targets:
    - "tools/..."
    - "test/..."
    test_flags:
    - "--spawn_strategy=local"
    - "--test_env=PATH"
    # `bazel test` tries to build everything also by default, so skip that so the
    # *_library targets in examples/... aren't built (and fail since they are
    # platform specific).
    - "--build_tests_only"
    test_targets:
    - "tools/..."
    - "test/..."
    - "examples/..."

  macos_latest_head_deps:
    name: "Latest Bazel with Head Deps"
    platform: macos
    # TODO(b/130360213): Remove this default to use whatever the default in
    # BuildKite is.
    xcode_version: "10.1"
    bazel: latest
    shell_commands:
    # Update the WORKSPACE to use head versions of some deps to ensure nothing
    # has landed on them breaking this project.
    - .bazelci/update_workspace_to_deps_heads.sh
    build_targets:
    - "tools/..."
    - "test/..."
    test_flags:
    - "--spawn_strategy=local"
    - "--test_env=PATH"
    # `bazel test` tries to build everything also by default, so skip that so the
    # *_library targets in examples/... aren't built (and fail since they are
    # platform specific).
    - "--build_tests_only"
    test_targets:
    - "tools/..."
    - "test/..."
    - "examples/..."


buildifier:
  version: latest
  # Function doc string requirements are a little hard to follow, they did get
  # split into multiple warnings, so there is now just one left that causes
  # warnings. For the history of some of the issues, see:
  #  https://github.com/bazelbuild/buildtools/issues/576
  warnings: -function-docstring-args
